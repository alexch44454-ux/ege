<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ï–ì–≠ –ê—Ä–∫–∞–¥–∞ - –†—É—Å—Å–∫–∏–π —è–∑—ã–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: Arial, sans-serif;
            background: #fff;
            color: #000;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .top-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: #f0f0f0;
            border-bottom: 1px solid #ccc;
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 5px;
            padding-top: calc(10px + env(safe-area-inset-top, 0));
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 5px;
            cursor: pointer;
            border-radius: 4px;
            min-width: 0;
        }

        .nav-item.active {
            background: #ddd;
        }

        .nav-item-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-item-text {
            font-size: 11px;
            text-align: center;
        }


        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }

        .screen.active {
            display: block;
        }
        
        .screen.active.subject-select-screen {
            display: flex;
        }

        .screen.with-navbar {
            padding-top: 60px;
        }


        /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ */
        .subject-select-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .subject-btn {
            width: 200px;
            padding: 20px;
            margin: 10px;
            font-size: 18px;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 4px;
        }

        .subject-btn:hover {
            background: #f0f0f0;
        }


        /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π */
        .level-select-screen {
            padding: 20px;
        }

        .path-container {
            position: relative;
            width: 100%;
            min-height: auto;
            padding: 0;
            padding-top: 0;
            padding-bottom: 20px;
        }

        .levels-list {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 30px;
            padding-top: 0;
            margin-top: 0;
        }

        .levels-list .level-item:last-child {
            margin-top: 60px;
        }

        .level-item {
            display: flex;
            align-items: center;
            position: relative;
            width: 100%;
            max-width: 400px;
        }

        .level-node {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #000;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 15px;
        }

        .level-node:hover {
            background: #f0f0f0;
        }

        .level-node.completed {
            background: #e0e0e0;
        }

        .level-info {
            flex: 1;
        }

        .level-info h3 {
            margin-bottom: 5px;
        }

        .level-info p {
            font-size: 14px;
            color: #666;
        }

        .level-stars {
            margin-top: 5px;
            font-size: 14px;
        }

        .start-label {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            padding: 8px 16px;
            border: 1px solid #000;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
        }

        /* –≠–∫—Ä–∞–Ω –æ–±—ä—è—Å–Ω–µ–Ω–∏—è */
        .explanation-screen {
            padding: 20px;
        }

        .explanation-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .explanation-content h2 {
            margin-bottom: 20px;
        }

        .explanation-content h3 {
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .start-practice-btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 16px;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 4px;
        }

        .start-practice-btn:hover {
            background: #f0f0f0;
        }

        /* –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã */
        .game-screen {
            padding: 20px;
        }

        .back-btn {
            margin-bottom: 20px;
            padding: 10px 20px;
            border: 1px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 4px;
        }

        .back-btn:hover {
            background: #f0f0f0;
        }

        .header {
            margin-bottom: 20px;
        }

        .header h1 {
            margin-bottom: 15px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            border: 1px solid #000;
            background: #fff;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #000;
            width: 0%;
            transition: width 0.3s;
        }

        .game-area {
            width: 100%;
            height: 200px;
            border: 1px solid #ccc;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .falling-word {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            animation: fall linear;
        }

        @keyframes fall {
            from {
                top: -50px;
            }
            to {
                top: 100%;
            }
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #000;
            border-radius: 50%;
        }

        .question-container {
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-btn {
            padding: 15px;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            text-align: left;
        }

        .answer-btn:hover:not(:disabled) {
            background: #f0f0f0;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
        }

        .answer-btn.correct {
            background: #90ee90;
        }

        .answer-btn.wrong {
            background: #ff6b6b;
        }

        .level-complete {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .level-complete.show {
            display: block;
        }

        .final-stats {
            margin: 20px 0;
        }

        .final-stats p {
            margin: 10px 0;
            font-size: 16px;
        }

        .btn {
            padding: 15px 30px;
            margin: 10px;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
        }

        .btn:hover {
            background: #f0f0f0;
        }

        .btn-secondary {
            background: #e0e0e0;
        }

        .question-container.hidden {
            display: none;
        }

    </style>
</head>
<body>
    <div class="game-container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="top-navbar" id="topNavbar" style="display: none;">
            <div class="nav-item active" onclick="switchCategory('arcade')" data-category="arcade">
                <div class="nav-item-icon">üéÆ</div>
                <div class="nav-item-text">–ê—Ä–∫–∞–¥–∞</div>
            </div>
            <div class="nav-item" onclick="switchCategory('orthography')" data-category="orthography">
                <div class="nav-item-icon">üìù</div>
                <div class="nav-item-text">–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è</div>
            </div>
            <div class="nav-item" onclick="switchCategory('punctuation')" data-category="punctuation">
                <div class="nav-item-icon">‚úèÔ∏è</div>
                <div class="nav-item-text">–ü—É–Ω–∫—Ç—É–∞—Ü–∏—è</div>
            </div>
            <div class="nav-item" onclick="switchCategory('grammar')" data-category="grammar">
                <div class="nav-item-icon">üìö</div>
                <div class="nav-item-text">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</div>
            </div>
            <div class="nav-item" onclick="switchCategory('settings')" data-category="settings">
                <div class="nav-item-icon">‚öôÔ∏è</div>
                <div class="nav-item-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ -->
        <div class="screen subject-select-screen" id="subjectSelectScreen">
            <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</h1>
            <button class="subject-btn" onclick="selectSubject('russian')">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π -->
        <div class="screen level-select-screen" id="levelSelectScreen">
            <div class="path-container">
                <div class="levels-list" id="levelsList"></div>
                <div class="start-label">–ù–ê–ß–ê–¢–¨</div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ–±—ä—è—Å–Ω–µ–Ω–∏—è -->
        <div class="screen explanation-screen" id="explanationScreen">
            <button class="back-btn" onclick="backToLevelSelect()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="explanation-content" id="explanationContent"></div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div class="screen game-screen" id="gameScreen">
            <button class="back-btn" onclick="backToLevelSelect()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="header">
                <h1 id="levelTitle">–ï–ì–≠ –ê—Ä–∫–∞–¥–∞</h1>
                <div class="stats">
                    <div class="stat-item">
                        <span>–û—á–∫–∏</span>
                        <span class="stat-value" id="score">0</span>
                    </div>
                    <div class="stat-item">
                        <span>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</span>
                        <span class="stat-value" id="correct">0</span>
                    </div>
                    <div class="stat-item">
                        <span>–í–æ–ø—Ä–æ—Å</span>
                        <span class="stat-value" id="questionNum">0</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
            </div>

            <div class="game-area" id="gameArea"></div>

            <div class="question-container" id="questionContainer">
                <div class="question-text" id="questionText"></div>
                <div class="answers" id="answers"></div>
            </div>

            <div class="level-complete" id="levelComplete">
                <h2>–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!</h2>
                <div class="final-stats">
                    <p>–û—á–∫–∏: <span id="finalScore">0</span></p>
                    <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: <span id="finalCorrect">0</span>/<span id="finalTotal">0</span></p>
                    <p>–¢–æ—á–Ω–æ—Å—Ç—å: <span id="finalAccuracy">0</span>%</p>
                    <p>–ó–≤–µ–∑–¥—ã: <span id="finalStars">0</span></p>
                </div>
                <button class="btn" onclick="backToLevelSelect()">–ö —É—Ä–æ–≤–Ω—è–º</button>
                <button class="btn btn-secondary" onclick="restartLevel()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
            </div>
        </div>

    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram?.WebApp;

        // –¢–µ–∫—É—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        let currentCategory = 'arcade';

        const levels = [
            {
                id: 1,
                title: "–ë–ª–æ–∫ 1: –£–¥–∞—Ä–µ–Ω–∏–µ",
                description: "–£–¥–∞—Ä–µ–Ω–∏–µ –≤ –≥–ª–∞–≥–æ–ª–∞—Ö –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞",
                category: 'orthography',
                explanation: {
                    title: "–£–¥–∞—Ä–µ–Ω–∏–µ –≤ –≥–ª–∞–≥–æ–ª–∞—Ö –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞",
                    content: `
                        <h3>–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ</h3>
                        <p>–í –≥–ª–∞–≥–æ–ª–∞—Ö –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ —É–¥–∞—Ä–µ–Ω–∏–µ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ <strong>–ê</strong>.</p>
                        
                        <div>
                            <div>–ü—Ä–∏–º–µ—Ä—ã:</div>
                            <div>–±—Ä–∞–ª–ê, –±—Ä–∞–ª–ê—Å—å, –≤–∑—è–ª–ê, –≤–∑—è–ª–ê—Å—å, –≤–ª–∏–ª–ê—Å—å, –≤–æ—Ä–≤–∞–ª–ê—Å—å, –≤–æ—Å–ø—Ä–∏–Ω—è–ª–ê, –≤–æ—Å—Å–æ–∑–¥–∞–ª–ê, –≥–Ω–∞–ª–ê, –≥–Ω–∞–ª–ê—Å—å, –¥–æ–±—Ä–∞–ª–ê, –¥–æ–±—Ä–∞–ª–ê—Å—å, –¥–æ–∂–¥–∞–ª–ê—Å—å, –∂–¥–∞–ª–ê, –∑–∞–Ω—è–ª–ê, –∑–∞–ø–µ—Ä–ª–ê, –∑–∞–ø–µ—Ä–ª–ê—Å—å, –∑–≤–∞–ª–ê, –ª–≥–∞–ª–ê, –ª–∏–ª–ê, –ª–∏–ª–ê—Å—å, –Ω–∞–≤—Ä–∞–ª–ê, –Ω–∞–¥–æ—Ä–≤–∞–ª–ê—Å—å, –Ω–∞–∑–≤–∞–ª–ê—Å—å, –Ω–∞–ª–∏–ª–ê, –Ω–∞—Ä–≤–∞–ª–ê, –Ω–∞—á–∞–ª–ê, –æ–±–ª–∏–ª–ê—Å—å, –æ–±–Ω—è–ª–ê—Å—å, –æ–±–æ–≥–Ω–∞–ª–ê, –æ–±–æ–¥—Ä–∞–ª–ê, –æ—Ç–±—ã–ª–ê, –æ—Ç–¥–∞–ª–ê, –æ—Ç–æ–∑–≤–∞–ª–ê, –æ—Ç–æ–∑–≤–∞–ª–ê—Å—å, –ø–µ—Ä–µ–ª–∏–ª–ê, –ø–æ–∑–≤–∞–ª–ê, –ø–æ–ª–∏–ª–ê, –ø–æ–Ω—è–ª–ê, –ø—Ä–∏–±—ã–ª–ê, —Ä–≤–∞–ª–ê, —Å–Ω—è–ª–ê, —Å–æ–∑–¥–∞–ª–ê, —Å–æ—Ä–≤–∞–ª–ê, —É–±—Ä–∞–ª–ê</div>
                        </div>

                        <div>
                            <div>–ò—Å–∫–ª—é—á–µ–Ω–∏–µ 1: –ü—Ä–∏—Å—Ç–∞–≤–∫–∞ –í–´-</div>
                            <p>–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –≥–ª–∞–≥–æ–ª—ã –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π <strong>–í–´-</strong>, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è:</p>
                            <div>–≤–´–ª–∏–ª–∞, –≤–´–∑–≤–∞–ª–∞</div>
                        </div>

                        <div>
                            <div>–ò—Å–∫–ª—é—á–µ–Ω–∏–µ 2: –û—Å–æ–±—ã–µ –≥–ª–∞–≥–æ–ª—ã</div>
                            <p>–£ –≥–ª–∞–≥–æ–ª–æ–≤ <strong>–∫–ª–∞—Å—Ç—å, –∫—Ä–∞—Å—Ç—å—Å—è, —Å–ª–∞—Ç—å, –ø–æ—Å–ª–∞—Ç—å, –æ—Ç–æ—Å–ª–∞—Ç—å</strong> —É–¥–∞—Ä–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ <strong>–ù–ï</strong> –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê, –∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ:</p>
                            <div>–∫–ª–ê–ª–∞, –∫—Ä–ê–ª–∞—Å—å, —Å–ª–ê–ª–∞, –ø–æ—Å–ª–ê–ª–∞, –æ—Ç–æ—Å–ª–ê–ª–∞</div>
                        </div>
                    `
                },
                questions: [
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–±—Ä–ê–ª–∞", "–±—Ä–ê–ª–ê", "–±—Ä–∞–ª–ê", "–±—Ä–ê–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –±—Ä–∞–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–≤–∑–Ø–ª–∞", "–≤–∑–Ø–ª–ê", "–≤–∑—è–ª–ê", "–≤–∑–Ø–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–∑—è–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–ø–æ–Ω–Ø–ª–∞", "–ø–æ–Ω–Ø–ª–ê", "–ø–æ–Ω—è–ª–ê", "–ø–æ–Ω–Ø–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø–æ–Ω—è–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["—Å–æ–∑–¥–ê–ª–∞", "—Å–æ–∑–¥–ê–ª–ê", "—Å–æ–∑–¥–∞–ª–ê", "—Å–æ–∑–¥–ê–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Å–æ–∑–¥–∞–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–∑–≤–ê–ª–∞", "–∑–≤–ê–ª–ê", "–∑–≤–∞–ª–ê", "–∑–≤–ê–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∑–≤–∞–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π –í–´-)?",
                        answers: ["–≤–´–ª–∏–ª–∞", "–≤—ã–ª–ò–ª–∞", "–≤—ã–ª–∏–ª–ê", "–≤–´–ª–∏–ª–ê"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–´–ª–∏–ª–∞ - –ø—Ä–∏—Å—Ç–∞–≤–∫–∞ –í–´- –ø–µ—Ä–µ—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π –í–´-)?",
                        answers: ["–≤–´–∑–≤–∞–ª–∞", "–≤—ã–∑–≤–ê–ª–∞", "–≤—ã–∑–≤–∞–ª–ê", "–≤–´–∑–≤–∞–ª–ê"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–´–∑–≤–∞–ª–∞ - –ø—Ä–∏—Å—Ç–∞–≤–∫–∞ –í–´- –ø–µ—Ä–µ—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–æ—Å–æ–±—ã–π –≥–ª–∞–≥–æ–ª)?",
                        answers: ["–∫–ª–ê–ª–∞", "–∫–ª–ê–ª–ê", "–∫–ª–∞–ª–ê", "–∫–ª–ê–ª–ê—Å—å"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∫–ª–ê–ª–∞ - —É –≥–ª–∞–≥–æ–ª–∞ '–∫–ª–∞—Å—Ç—å' —É–¥–∞—Ä–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–æ—Å–æ–±—ã–π –≥–ª–∞–≥–æ–ª)?",
                        answers: ["—Å–ª–ê–ª–∞", "—Å–ª–ê–ª–ê", "—Å–ª–∞–ª–ê", "—Å–ª–ê–ª–ê—Å—å"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Å–ª–ê–ª–∞ - —É –≥–ª–∞–≥–æ–ª–∞ '—Å–ª–∞—Ç—å' —É–¥–∞—Ä–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–ø—Ä–∏–±–´–ª–∞", "–ø—Ä–∏–±–´–ª–ê", "–ø—Ä–∏–±—ã–ª–ê", "–ø—Ä–∏–±–´–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø—Ä–∏–±—ã–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    }
                ]
            },
            {
                id: 2,
                title: "–£—Ä–æ–≤–µ–Ω—å 2: –ü—É–Ω–∫—Ç—É–∞—Ü–∏—è",
                description: "–ó–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è",
                category: 'punctuation',
                questions: [
                    {
                        question: "–£–∫–∞–∂–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –ø—É–Ω–∫—Ç—É–∞—Ü–∏–æ–Ω–Ω–æ–π –æ—à–∏–±–∫–æ–π:",
                        answers: [
                            "–°–æ–ª–Ω—Ü–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤–µ—Ç–∏–ª–æ —è—Ä–∫–æ, —Å–æ–≥—Ä–µ–≤–∞–ª–æ –∑–µ–º–ª—é.",
                            "–û–Ω –ø—Ä–∏—à–µ–ª, –Ω–æ –æ–Ω–∞ —É–∂–µ —É—à–ª–∞.",
                            "–í –ª–µ—Å—É, –≥–¥–µ –º—ã –≥—É–ª—è–ª–∏, –±—ã–ª–æ —Ç–∏—Ö–æ.",
                            "–Ø –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –¥–µ–ª–∞—Ç—å."
                        ],
                        correct: 0,
                        explanation: "–í –ø–µ—Ä–≤–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –∑–∞–ø—è—Ç–∞—è –ø–µ—Ä–µ–¥ '–∫–æ—Ç–æ—Ä–æ–µ' –Ω–µ –Ω—É–∂–Ω–∞"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∏—Ä–µ?",
                        answers: [
                            "–ú–æ—Å–∫–≤–∞ —Å—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏.",
                            "–ú–æ—Å–∫–≤–∞ —ç—Ç–æ —Å—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏.",
                            "–ú–æ—Å–∫–≤–∞ –±—ã–ª–∞ —Å—Ç–æ–ª–∏—Ü–µ–π –†–æ—Å—Å–∏–∏.",
                            "–ú–æ—Å–∫–≤–∞ —Å—Ç–∞–ª–∞ —Å—Ç–æ–ª–∏—Ü–µ–π –†–æ—Å—Å–∏–∏."
                        ],
                        correct: 0,
                        explanation: "–¢–∏—Ä–µ —Å—Ç–∞–≤–∏—Ç—Å—è –º–µ–∂–¥—É –ø–æ–¥–ª–µ–∂–∞—â–∏–º –∏ —Å–∫–∞–∑—É–µ–º—ã–º, –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–º–∏ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏"
                    },
                    {
                        question: "–ì–¥–µ –Ω—É–∂–Ω–∞ –∑–∞–ø—è—Ç–∞—è?",
                        answers: [
                            "–û–Ω –ø—Ä–∏—à–µ–ª(,) –Ω–æ –æ–Ω–∞ —É—à–ª–∞.",
                            "–û–Ω –ø—Ä–∏—à–µ–ª –Ω–æ(,) –æ–Ω–∞ —É—à–ª–∞.",
                            "–û–Ω –ø—Ä–∏—à–µ–ª –Ω–æ –æ–Ω–∞(,) —É—à–ª–∞.",
                            "–ó–∞–ø—è—Ç–∞—è –Ω–µ –Ω—É–∂–Ω–∞"
                        ],
                        correct: 0,
                        explanation: "–ó–∞–ø—è—Ç–∞—è —Å—Ç–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—é–∑–æ–º '–Ω–æ'"
                    }
                ]
            },
            {
                id: 3,
                title: "–£—Ä–æ–≤–µ–Ω—å 3: –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞",
                description: "–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å",
                category: 'grammar',
                questions: [
                    {
                        question: "–í –∫–∞–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –ù–ï —Å–æ —Å–ª–æ–≤–æ–º –ø–∏—à–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ?",
                        answers: [
                            "–≠—Ç–æ (–Ω–µ)–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å.",
                            "–û–Ω (–Ω–µ)–≤—ã—Å–æ–∫–∏–π, –∞ –Ω–∏–∑–∫–∏–π.",
                            "–ó–∞–¥–∞—á–∞ (–Ω–µ)—Ä–µ—à–µ–Ω–∞.",
                            "–û–Ω (–Ω–µ)–ø—Ä–∏—è—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫."
                        ],
                        correct: 1,
                        explanation: "–ù–ï –ø–∏—à–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —Å–æ—é–∑–æ–º '–∞'"
                    },
                    {
                        question: "–£–∫–∞–∂–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–æ–π:",
                        answers: [
                            "–û–Ω –ø—Ä–∏—à–µ–ª —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.",
                            "–ë–ª–∞–≥–æ–¥–∞—Ä—è –¥–æ–∂–¥—é, —É—Ä–æ–∂–∞–π –±—ã–ª —Ö–æ—Ä–æ—à–∏–º.",
                            "–ü–æ –ø—Ä–∏–µ–∑–¥—É –≤ –≥–æ—Ä–æ–¥, –æ–Ω —Å—Ä–∞–∑—É –ø–æ—à–µ–ª –≤ –º—É–∑–µ–π.",
                            "–í–æ–ø—Ä–µ–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º, –≤—Å–µ –ø—Ä–æ—à–ª–æ —Ö–æ—Ä–æ—à–æ."
                        ],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø–æ –ø—Ä–∏–µ–∑–¥–µ (–ø—Ä–µ–¥–ª–æ–≥ –ü–û —Ç—Ä–µ–±—É–µ—Ç –¥–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–¥–µ–∂–∞)"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ –ø–∏—à–µ—Ç—Å—è –¨?",
                        answers: ["–ø–ª–∞—â..", "–º—ã—à..", "–Ω–æ—á..", "–∫–ª—é—á.."],
                        correct: 1,
                        explanation: "–ú—è–≥–∫–∏–π –∑–Ω–∞–∫ –ø–∏—à–µ—Ç—Å—è –ø–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ 3-–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è"
                    }
                ]
            },
            {
                id: 4,
                title: "–£—Ä–æ–≤–µ–Ω—å 4: –£–¥–∞—Ä–µ–Ω–∏—è",
                description: "–û—Ä—Ñ–æ—ç–ø–∏—è",
                category: 'orthography',
                questions: [
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–ª–æ–≥?",
                        answers: ["–∑–≤–æ–Ω–ò—Ç", "–∫–≤–∞—Ä—Ç–ê–ª", "–¥–û–≥–æ–≤–æ—Ä", "—Å—Ä–µ–¥—Å—Ç–≤–ê"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –¥–û–≥–æ–≤–æ—Ä (—É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–ª–æ–≥)"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–≥?",
                        answers: ["–∑–≤–æ–Ω–ò—Ç", "–∫–≤–∞—Ä—Ç–ê–ª", "–¥–û–≥–æ–≤–æ—Ä", "—Å—Ä–µ–¥—Å—Ç–≤–ê"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∑–≤–æ–Ω–ò—Ç (—É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–≥)"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–æ–≥?",
                        answers: ["–∑–≤–æ–Ω–ò—Ç", "–∫–≤–∞—Ä—Ç–ê–ª", "–¥–û–≥–æ–≤–æ—Ä", "—Å—Ä–µ–¥—Å—Ç–≤–ê"],
                        correct: 1,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∫–≤–∞—Ä—Ç–ê–ª (—É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–æ–≥)"
                    }
                ]
            },
            {
                id: 5,
                title: "–£—Ä–æ–≤–µ–Ω—å 5: –õ–µ–∫—Å–∏–∫–∞",
                description: "–°–ª–æ–≤–∞—Ä–Ω—ã–µ —Å–ª–æ–≤–∞",
                category: 'orthography',
                questions: [
                    {
                        question: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:",
                        answers: [
                            "–û–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ",
                            "–û–¥–µ—Ç—å—Å—è –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å—Å—è –ø–∞–ª—å—Ç–æ"
                        ],
                        correct: 1,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–∞–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ (–Ω–∞–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –Ω–∞ —Å–µ–±—è)"
                    },
                    {
                        question: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:",
                        answers: [
                            "–û–¥–µ—Ç—å —Ä–µ–±–µ–Ω–∫–∞",
                            "–ù–∞–¥–µ—Ç—å —Ä–µ–±–µ–Ω–∫–∞",
                            "–û–¥–µ—Ç—å—Å—è —Ä–µ–±–µ–Ω–∫–∞",
                            "–ù–∞–¥–µ—Ç—å—Å—è —Ä–µ–±–µ–Ω–∫–∞"
                        ],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –æ–¥–µ—Ç—å —Ä–µ–±–µ–Ω–∫–∞ (–æ–¥–µ—Ç—å –∫–æ–≥–æ-—Ç–æ)"
                    },
                    {
                        question: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:",
                        answers: [
                            "–û–¥–µ—Ç—å—Å—è –≤ –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å—Å—è –≤ –ø–∞–ª—å—Ç–æ",
                            "–û–¥–µ—Ç—å –≤ –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å –≤ –ø–∞–ª—å—Ç–æ"
                        ],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –æ–¥–µ—Ç—å—Å—è –≤ –ø–∞–ª—å—Ç–æ (–æ–¥–µ—Ç—å—Å—è –≤–æ —á—Ç–æ-—Ç–æ)"
                    }
                ]
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let currentLevel = null;
        let currentQuestion = 0;
        let score = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let gameStartTime = Date.now();
        let fallingWordsInterval = null;
        let questionTimeout = null;
        let consecutiveCorrect = 0;
        let completedLevels = JSON.parse(localStorage.getItem('completedLevels') || '{}');

        // –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–≤
        function showScreen(screenId, options = {}) {
            // –°–∫—Ä—ã–≤–∞–µ–º –í–°–ï —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
                screen.classList.remove('with-navbar');
                screen.classList.remove('with-bottom-nav');
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª—è–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const topNavbar = document.getElementById('topNavbar');
            
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
            if (options.topNavbar !== undefined) {
                topNavbar.style.display = options.topNavbar ? 'flex' : 'none';
            } else {
                topNavbar.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if (options.withNavbar) {
                    targetScreen.classList.add('with-navbar');
                }
            } else {
                console.error('–≠–∫—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω:', screenId);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            if (typeof tg !== 'undefined' && tg) {
                tg.ready();
                tg.expand();
                tg.enableClosingConfirmation(false);
                tg.setHeaderColor('#ffffff');
                tg.BackButton.hide();
            }
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–∫—Ä–∞–Ω—ã —Å–∫—Ä—ã—Ç—ã
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
            const subjectScreen = document.getElementById('subjectSelectScreen');
            if (subjectScreen) {
                subjectScreen.classList.add('active');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const topNavbar = document.getElementById('topNavbar');
            if (topNavbar) topNavbar.style.display = 'none';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            loadProgressFromServer();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
        function loadProgressFromServer() {
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–µ—Å–ª–∏ –±–æ—Ç –ø–µ—Ä–µ–¥–∞–ª —á–µ—Ä–µ–∑ start_param)
            const urlParams = new URLSearchParams(window.location.search);
            const progressParam = urlParams.get('progress');
            if (progressParam) {
                try {
                    const serverProgress = JSON.parse(decodeURIComponent(progressParam));
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —Å–µ—Ä–≤–µ—Ä–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ)
                    Object.keys(serverProgress).forEach(levelId => {
                        const serverLevel = serverProgress[levelId];
                        const localLevel = completedLevels[levelId];
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–æ–ª—å—à–µ –∑–≤–µ–∑–¥)
                        if (!localLevel || serverLevel.stars > localLevel.stars) {
                            completedLevels[levelId] = serverLevel;
                        }
                    });
                    localStorage.setItem('completedLevels', JSON.stringify(completedLevels));
                    console.log('–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑ URL:', e);
                }
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
            if (tg && tg.sendData) {
                const syncRequest = {
                    action: 'sync_progress',
                    completedLevels: completedLevels
                };
                tg.sendData(JSON.stringify(syncRequest));
            }
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
        function syncProgressToServer() {
            if (tg && tg.sendData) {
                const syncData = {
                    action: 'save_progress',
                    completedLevels: completedLevels
                };
                tg.sendData(JSON.stringify(syncData));
            }
        }

        // –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞
        function selectSubject(subject) {
            if (subject === 'russian') {
                // –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∞—Ä–∫–∞–¥—É
                currentCategory = 'arcade';
                updateNavbar();
                showScreen('levelSelectScreen', {
                    topNavbar: true,
                    withNavbar: true
                });
                renderLevelSelect();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∏–∑ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –≤ –∞—Ä–∫–∞–¥–µ)
        function switchCategory(category) {
            currentCategory = category;
            updateNavbar();
            
            // –û—Å—Ç–∞–µ–º—Å—è –≤ –∞—Ä–∫–∞–¥–µ, –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            showScreen('levelSelectScreen', {
                topNavbar: true,
                withNavbar: true
            });
            renderLevelSelect();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateNavbar() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.category === currentCategory) {
                    item.classList.add('active');
                }
            });
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç–∫—Ä–∞–Ω–∞ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π
        function renderLevelSelect() {
            const levelsList = document.getElementById('levelsList');
            const pathContainer = document.querySelector('.path-container');
            levelsList.innerHTML = '';

            // –§–∏–ª—å—Ç—Ä—É–µ–º —É—Ä–æ–≤–Ω–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let filteredLevels = levels;
            if (currentCategory === 'orthography') {
                filteredLevels = levels.filter(l => l.category === 'orthography');
            } else if (currentCategory === 'punctuation') {
                filteredLevels = levels.filter(l => l.category === 'punctuation');
            } else if (currentCategory === 'grammar') {
                filteredLevels = levels.filter(l => l.category === 'grammar');
            } else if (currentCategory === 'arcade') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —É—Ä–æ–≤–Ω–∏
                filteredLevels = levels;
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É—Ä–æ–≤–Ω–∏ –≤ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (column-reverse –ø–æ–∫–∞–∂–µ—Ç –∏—Ö —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
            filteredLevels.forEach((level, index) => {
                const isCompleted = completedLevels[level.id];

                const levelItem = document.createElement('div');
                levelItem.className = 'level-item';
                levelItem.dataset.levelIndex = index;

                const levelNode = document.createElement('div');
                levelNode.className = 'level-node';
                
                // –í—Å–µ —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ)
                if (isCompleted) {
                    // –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–≤–µ–∑–¥—É, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å–Ω–æ–≤–∞
                    levelNode.classList.add('completed');
                    levelNode.textContent = '‚≠ê';
                    levelNode.onclick = () => startLevel(level);
                    levelNode.title = '–ü—Ä–æ–π–¥–µ–Ω. –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞';
                } else {
                    // –ù–µ–ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä
                    levelNode.classList.add('available');
                    levelNode.textContent = level.id;
                    levelNode.onclick = () => startLevel(level);
                    levelNode.title = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å';
                }

                const levelInfo = document.createElement('div');
                levelInfo.className = 'level-info';
                levelInfo.innerHTML = `
                    <h3>${level.title}</h3>
                    <p>${level.description}</p>
                    ${isCompleted ? `<div class="level-stars">‚≠ê ${completedLevels[level.id].stars || 0}/3</div><div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">–ú–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞</div>` : ''}
                `;

                levelItem.appendChild(levelNode);
                levelItem.appendChild(levelInfo);
                levelsList.appendChild(levelItem);
            });

            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ (–∫ –ø–µ—Ä–≤–æ–º—É —É—Ä–æ–≤–Ω—é) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(() => {
                const levelSelectScreen = document.getElementById('levelSelectScreen');
                levelSelectScreen.scrollTop = levelSelectScreen.scrollHeight;
            }, 100);
        }

        // –ó–∞–ø—É—Å–∫ —É—Ä–æ–≤–Ω—è
        function startLevel(level) {
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            correctAnswers = 0;
            totalQuestions = 0;
            consecutiveCorrect = 0;
            gameStartTime = Date.now();

            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ —Å–Ω–∞—á–∞–ª–∞
            if (level.explanation) {
                showExplanation(level);
            } else {
                // –ï—Å–ª–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –Ω–µ—Ç, —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–∞–∫—Ç–∏–∫—É
                startPractice();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        function showExplanation(level) {
            showScreen('explanationScreen', {
                topNavbar: false
            });

            const explanationContent = document.getElementById('explanationContent');
            explanationContent.innerHTML = `
                <h2>${level.explanation.title}</h2>
                ${level.explanation.content}
                <button class="start-practice-btn" onclick="startPractice()">
                    –ù–∞—á–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É
                </button>
            `;
        }

        // –ù–∞—á–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É (–ø–æ—Å–ª–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è)
        function startPractice() {
            showScreen('gameScreen', {
                topNavbar: false
            });
            document.getElementById('levelTitle').textContent = currentLevel.title;
            document.getElementById('levelComplete').classList.remove('show');
            document.getElementById('questionContainer').classList.remove('hidden');

            updateStats();
            showQuestion();
            startFallingWords();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        function showQuestion() {
            if (!currentLevel || currentQuestion >= currentLevel.questions.length) {
                completeLevel();
                return;
            }

            const q = currentLevel.questions[currentQuestion];
            document.getElementById('questionText').textContent = q.question;
            
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';

            q.answers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => selectAnswer(index);
                answersDiv.appendChild(btn);
            });

            totalQuestions++;
            updateStats();

            if (questionTimeout) clearTimeout(questionTimeout);
            questionTimeout = setTimeout(() => {
                selectAnswer(-1);
            }, 30000);
        }

        // –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
        function selectAnswer(selectedIndex) {
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            const q = currentLevel.questions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === q.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && index !== q.correct) {
                    btn.classList.add('wrong');
                }
            });

            if (selectedIndex === q.correct) {
                correctAnswers++;
                consecutiveCorrect++;
                score += 10 + (consecutiveCorrect > 1 ? 5 : 0);
                createParticles();
            } else {
                consecutiveCorrect = 0;
                if (selectedIndex !== -1) {
                    score = Math.max(0, score - 5);
                }
            }

            updateStats();

            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 2000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('correct').textContent = correctAnswers;
            document.getElementById('questionNum').textContent = totalQuestions;
            
            if (currentLevel) {
                const progress = (totalQuestions / currentLevel.questions.length) * 100;
                document.getElementById('progress').style.width = progress + '%';
            }
        }

        // –ü–∞–¥–∞—é—â–∏–µ —Å–ª–æ–≤–∞
        function startFallingWords() {
            if (fallingWordsInterval) clearInterval(fallingWordsInterval);
            
            const words = ['–ï–ì–≠', '–†—É—Å—Å–∫–∏–π', '–Ø–∑—ã–∫', '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞', '–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è', '–ü—É–Ω–∫—Ç—É–∞—Ü–∏—è'];
            
            fallingWordsInterval = setInterval(() => {
                const word = words[Math.floor(Math.random() * words.length)];
                createFallingWord(word);
            }, 2000);
        }

        function createFallingWord(word) {
            const gameArea = document.getElementById('gameArea');
            const wordEl = document.createElement('div');
            wordEl.className = 'falling-word';
            wordEl.textContent = word;
            wordEl.style.left = Math.random() * (gameArea.offsetWidth - 100) + 'px';
            wordEl.style.animationDuration = (3 + Math.random() * 2) + 's';
            gameArea.appendChild(wordEl);

            setTimeout(() => {
                wordEl.remove();
            }, 5000);
        }

        function createParticles() {
            const gameArea = document.getElementById('gameArea');
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * gameArea.offsetWidth + 'px';
                particle.style.top = (gameArea.offsetHeight - 200) + 'px';
                particle.style.animationDelay = (Math.random() * 0.5) + 's';
                gameArea.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        function completeLevel() {
            if (fallingWordsInterval) {
                clearInterval(fallingWordsInterval);
                fallingWordsInterval = null;
            }
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            document.getElementById('questionContainer').classList.add('hidden');
            
            const timeSpent = Math.floor((Date.now() - gameStartTime) / 1000);
            const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥ (1-3)
            let stars = 1;
            if (accuracy >= 100) stars = 3;
            else if (accuracy >= 70) stars = 2;

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const wasCompleted = completedLevels[currentLevel.id];
            if (!wasCompleted || completedLevels[currentLevel.id].stars < stars) {
                completedLevels[currentLevel.id] = {
                    stars: stars,
                    score: score,
                    accuracy: accuracy
                };
                localStorage.setItem('completedLevels', JSON.stringify(completedLevels));
            }

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalCorrect').textContent = correctAnswers;
            document.getElementById('finalTotal').textContent = totalQuestions;
            document.getElementById('finalAccuracy').textContent = accuracy;
            document.getElementById('finalStars').textContent = stars;

            document.getElementById('levelComplete').classList.add('show');

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –±–æ—Ç–∞
            if (tg && tg.sendData) {
                const result = {
                    level: currentLevel.id,
                    score: score,
                    correct: correctAnswers,
                    total: totalQuestions,
                    timeSpent: timeSpent,
                    accuracy: accuracy,
                    stars: stars,
                    completedLevels: completedLevels  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                };
                tg.sendData(JSON.stringify(result));
            }
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —Å–µ—Ä–≤–µ—Ä–æ–º
            syncProgressToServer();
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É —É—Ä–æ–≤–Ω–µ–π (–∏–∑ –∞—Ä–∫–∞–¥—ã)
        function backToLevelSelect() {
            if (fallingWordsInterval) {
                clearInterval(fallingWordsInterval);
                fallingWordsInterval = null;
            }
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            showScreen('levelSelectScreen', {
                topNavbar: true,
                withNavbar: true
            });
            renderLevelSelect();
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –ø—Ä–µ–¥–º–µ—Ç–∞
        function backToSubjectSelect() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
            if (fallingWordsInterval) {
                clearInterval(fallingWordsInterval);
                fallingWordsInterval = null;
            }
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
            showScreen('subjectSelectScreen', {
                topNavbar: false
            });
        }


        // –ü–æ–≤—Ç–æ—Ä —É—Ä–æ–≤–Ω—è
        function restartLevel() {
            if (currentLevel) {
                startLevel(currentLevel);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>





