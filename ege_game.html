<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ï–ì–≠ –ê—Ä–∫–∞–¥–∞ - –†—É—Å—Å–∫–∏–π —è–∑—ã–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .game-container {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π */
        .level-select-screen {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            padding: 0;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }

        .level-select-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(72, 187, 120, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(72, 187, 120, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .level-select-screen::-webkit-scrollbar {
            width: 8px;
        }

        .level-select-screen::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .level-select-screen::-webkit-scrollbar-thumb {
            background: rgba(72, 187, 120, 0.5);
            border-radius: 4px;
        }

        .level-select-header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .level-select-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .level-select-header p {
            font-size: 14px;
            opacity: 0.8;
        }

        .path-container {
            position: relative;
            min-height: calc(100vh - 100px);
            padding: 40px 20px 100px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            z-index: 1;
        }

        .start-label {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(72, 187, 120, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 4;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .path-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 60px;
            transform: translateX(-50%);
            z-index: 1;
        }

        .path-line::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 12px;
            background: linear-gradient(180deg, #8b7355 0%, #6b5d4f 50%, #4a3d2e 100%);
            transform: translateX(-50%);
            border-radius: 6px;
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 0, 0, 0.4);
        }

        .path-line::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 8px;
            background: repeating-linear-gradient(
                90deg,
                #a0826d 0px,
                #a0826d 2px,
                #8b7355 2px,
                #8b7355 4px
            );
            transform: translateX(-50%);
            border-radius: 4px;
            opacity: 0.6;
        }

        /* –ö–∞–º–Ω–∏ –Ω–∞ —Ç—Ä–æ–ø–∏–Ω–∫–µ */
        .path-stone {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #5a4a3a 0%, #3d2f20 100%);
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            z-index: 2;
        }

        .path-stone::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 5px;
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }

        /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –±–æ–∫–∞–º —Ç—Ä–æ–ø–∏–Ω–∫–∏ */
        .path-decoration {
            position: absolute;
            width: 30px;
            height: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 0;
            opacity: 0.3;
        }

        .path-decoration.grass-left {
            left: calc(50% - 50px);
            font-size: 20px;
        }

        .path-decoration.grass-right {
            left: calc(50% + 50px);
            font-size: 20px;
        }

        .levels-list {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 30px;
            padding-top: 20px;
        }

        .level-item {
            display: flex;
            align-items: center;
            position: relative;
            width: 100%;
            max-width: 400px;
        }

        .level-item:nth-child(odd) {
            flex-direction: row;
        }

        .level-item:nth-child(even) {
            flex-direction: row-reverse;
        }

        .level-node {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 3;
            border: 4px solid;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            flex-shrink: 0;
        }

        .level-node.locked {
            background: #4a5568;
            border-color: #2d3748;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .level-node.available {
            background: linear-gradient(135deg, #48bb78, #38a169);
            border-color: #2f855a;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px rgba(72, 187, 120, 0.6);
        }

        .level-node.completed {
            background: linear-gradient(135deg, #f6e05e, #ecc94b);
            border-color: #d69e2e;
        }

        .level-node.available::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid #48bb78;
            animation: ring-pulse 2s infinite;
        }

        @keyframes ring-pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .level-info {
            flex: 1;
            margin: 0 15px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .level-info h3 {
            font-size: 16px;
            margin-bottom: 4px;
            color: #fff;
        }

        .level-info p {
            font-size: 12px;
            opacity: 0.8;
            color: #e2e8f0;
        }

        .level-stars {
            margin-top: 5px;
            font-size: 16px;
        }

        .player-character {
            position: absolute;
            left: 50%;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            z-index: 6;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(72, 187, 120, 0.5);
            transform: translateX(-50%);
            transition: bottom 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 3px solid #2f855a;
        }

        .player-character::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            animation: shine 2s ease-in-out infinite;
        }

        .player-character:hover {
            transform: translateX(-50%) scale(1.15);
        }

        @keyframes float {
            0%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            50% {
                transform: translateX(-50%) translateY(-8px);
            }
        }

        @keyframes shine {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }

        .player-character.walking {
            animation: walk 0.6s ease-in-out infinite;
        }

        @keyframes walk {
            0%, 100% {
                transform: translateX(-50%) translateY(0) rotate(0deg);
            }
            25% {
                transform: translateX(-50%) translateY(-3px) rotate(-5deg);
            }
            75% {
                transform: translateX(-50%) translateY(-3px) rotate(5deg);
            }
        }

        /* –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã */
        .game-screen {
            background: rgba(0, 0, 0, 0.3);
        }

        .header {
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            font-size: 16px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
        }

        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.2);
        }

        .question-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px 20px 0 0;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .question-container.hidden {
            transform: translateY(100%);
        }

        .question-text {
            font-size: 18px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .answer-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .answer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .answer-btn.correct {
            background: #4caf50;
            border-color: #4caf50;
        }

        .answer-btn.wrong {
            background: #f44336;
            border-color: #f44336;
        }

        .answer-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .falling-word {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            animation: fall linear;
            pointer-events: none;
        }

        @keyframes fall {
            from {
                top: -50px;
                opacity: 1;
            }
            to {
                top: 100vh;
                opacity: 0;
            }
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-float 2s ease-out forwards;
        }

        @keyframes particle-float {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        .level-complete {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
        }

        .level-complete.show {
            display: flex;
        }

        .level-complete h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }

        .final-stats {
            text-align: center;
            margin-bottom: 30px;
        }

        .final-stats p {
            font-size: 20px;
            margin: 10px 0;
        }

        .btn {
            padding: 15px 30px;
            background: #4caf50;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #2196F3;
        }

        .btn-secondary:hover {
            background: #1976D2;
        }

        .progress-bar {
            height: 5px;
            background: rgba(255, 255, 255, 0.3);
            margin: 10px 0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4caf50;
            transition: width 0.3s ease;
        }

        .back-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            z-index: 20;
        }

        /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ */
        .mode-select-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .mode-select-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .mode-select-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .mode-select-header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .mode-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 400px;
        }

        .mode-btn {
            padding: 25px 30px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .mode-btn .mode-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .mode-btn .mode-description {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* –≠–∫—Ä–∞–Ω 9 –∑–∞–¥–∞–Ω–∏—è */
        .task9-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .word-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 40px 0;
            letter-spacing: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .word-display .gap {
            color: #ffd700;
            border-bottom: 3px solid #ffd700;
            padding: 0 10px;
        }

        .vowel-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .vowel-btn {
            padding: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            color: #fff;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .vowel-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .vowel-btn.correct {
            background: #4caf50;
            border-color: #4caf50;
        }

        .vowel-btn.wrong {
            background: #f44336;
            border-color: #f44336;
        }

        .vowel-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .full-word-reveal {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            animation: reveal 0.5s ease;
        }

        @keyframes reveal {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* –≠–∫—Ä–∞–Ω –æ–±—ä—è—Å–Ω–µ–Ω–∏—è */
        .explanation-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            overflow-y: auto;
        }

        .explanation-content {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .explanation-content h2 {
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .explanation-content h3 {
            font-size: 20px;
            margin-top: 25px;
            margin-bottom: 15px;
            color: #fff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }

        .explanation-content p {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 15px;
            color: #e2e8f0;
        }

        .explanation-content ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .explanation-content li {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 10px;
            color: #e2e8f0;
        }

        .explanation-content .example {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #48bb78;
        }

        .explanation-content .example-title {
            font-weight: bold;
            color: #48bb78;
            margin-bottom: 10px;
        }

        .explanation-content .exception {
            background: rgba(255, 193, 7, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }

        .explanation-content .exception-title {
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 10px;
        }

        .explanation-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .explanation-word {
            background: rgba(72, 187, 120, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            border: 2px solid rgba(72, 187, 120, 0.5);
        }

        .explanation-word .accent {
            color: #ffd700;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .start-practice-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .start-practice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ -->
        <div class="screen mode-select-screen active" id="modeSelectScreen">
            <div class="mode-select-header">
                <h1>üéÆ –ï–ì–≠ –ê—Ä–∫–∞–¥–∞</h1>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–≥—Ä—ã</p>
            </div>
            <div class="mode-buttons">
                <button class="mode-btn" onclick="selectMode('arcade')">
                    <div class="mode-icon">üéØ</div>
                    <div>–ê—Ä–∫–∞–¥–∞</div>
                    <div class="mode-description">–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–≤–Ω–∏ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏</div>
                </button>
                <button class="mode-btn" onclick="selectMode('task9')">
                    <div class="mode-icon">üìù</div>
                    <div>9 –ó–∞–¥–∞–Ω–∏–µ</div>
                    <div class="mode-description">–í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—É—é –≥–ª–∞—Å–Ω—É—é</div>
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π -->
        <div class="screen level-select-screen" id="levelSelectScreen">
            <div class="level-select-header">
                <h1>üó∫Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å</h1>
                <p>–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–≤–Ω–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É</p>
            </div>
            <div class="path-container">
                <div class="path-line"></div>
                <div class="levels-list" id="levelsList"></div>
                <div class="start-label">–ù–ê–ß–ê–¢–¨</div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ–±—ä—è—Å–Ω–µ–Ω–∏—è -->
        <div class="screen explanation-screen" id="explanationScreen">
            <button class="back-btn" onclick="backToLevelSelect()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="explanation-content" id="explanationContent"></div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div class="screen game-screen" id="gameScreen">
            <button class="back-btn" onclick="backToLevelSelect()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="header">
                <h1 id="levelTitle">üéÆ –ï–ì–≠ –ê—Ä–∫–∞–¥–∞</h1>
                <div class="stats">
                    <div class="stat-item">
                        <span>–û—á–∫–∏</span>
                        <span class="stat-value" id="score">0</span>
                    </div>
                    <div class="stat-item">
                        <span>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</span>
                        <span class="stat-value" id="correct">0</span>
                    </div>
                    <div class="stat-item">
                        <span>–í–æ–ø—Ä–æ—Å</span>
                        <span class="stat-value" id="questionNum">0</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
            </div>

            <div class="game-area" id="gameArea"></div>

            <div class="question-container" id="questionContainer">
                <div class="question-text" id="questionText"></div>
                <div class="answers" id="answers"></div>
            </div>

            <div class="level-complete" id="levelComplete">
                <h2>üéâ –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!</h2>
                <div class="final-stats">
                    <p>üèÜ –û—á–∫–∏: <span id="finalScore">0</span></p>
                    <p>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: <span id="finalCorrect">0</span>/<span id="finalTotal">0</span></p>
                    <p>üìà –¢–æ—á–Ω–æ—Å—Ç—å: <span id="finalAccuracy">0</span>%</p>
                    <p>‚≠ê –ó–≤–µ–∑–¥—ã: <span id="finalStars">0</span></p>
                </div>
                <button class="btn" onclick="backToLevelSelect()">–ö –∫–∞—Ä—Ç–µ —É—Ä–æ–≤–Ω–µ–π</button>
                <button class="btn btn-secondary" onclick="restartLevel()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω 9 –∑–∞–¥–∞–Ω–∏—è -->
        <div class="screen task9-screen" id="task9Screen">
            <button class="back-btn" onclick="backToModeSelect()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="header">
                <h1>üìù –ó–∞–¥–∞–Ω–∏–µ 9: –ü—Ä–æ–ø—É—â–µ–Ω–Ω–∞—è –≥–ª–∞—Å–Ω–∞—è</h1>
                <div class="stats">
                    <div class="stat-item">
                        <span>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</span>
                        <span class="stat-value" id="task9Correct">0</span>
                    </div>
                    <div class="stat-item">
                        <span>–í—Å–µ–≥–æ</span>
                        <span class="stat-value" id="task9Total">0</span>
                    </div>
                    <div class="stat-item">
                        <span>–¢–æ—á–Ω–æ—Å—Ç—å</span>
                        <span class="stat-value" id="task9Accuracy">0</span>%
                    </div>
                </div>
            </div>

            <div class="game-area" id="task9GameArea"></div>

            <div class="question-container" id="task9QuestionContainer">
                <div class="word-display" id="wordDisplay"></div>
                <div class="vowel-buttons" id="vowelButtons"></div>
                <div class="full-word-reveal" id="fullWordReveal" style="display: none;"></div>
            </div>

            <div class="level-complete" id="task9Complete">
                <h2>üéâ –ó–∞–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
                <div class="final-stats">
                    <p>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: <span id="task9FinalCorrect">0</span>/<span id="task9FinalTotal">0</span></p>
                    <p>üìà –¢–æ—á–Ω–æ—Å—Ç—å: <span id="task9FinalAccuracy">0</span>%</p>
                </div>
                <button class="btn" onclick="backToModeSelect()">–ö –≤—ã–±–æ—Ä—É —Ä–µ–∂–∏–º–∞</button>
                <button class="btn btn-secondary" onclick="restartTask9()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // –£—Ä–æ–≤–Ω–∏ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏
        const levels = [
            {
                id: 1,
                title: "–ë–ª–æ–∫ 1: –£–¥–∞—Ä–µ–Ω–∏–µ",
                description: "–£–¥–∞—Ä–µ–Ω–∏–µ –≤ –≥–ª–∞–≥–æ–ª–∞—Ö –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞",
                explanation: {
                    title: "–£–¥–∞—Ä–µ–Ω–∏–µ –≤ –≥–ª–∞–≥–æ–ª–∞—Ö –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞",
                    content: `
                        <h3>üìö –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ</h3>
                        <p>–í –≥–ª–∞–≥–æ–ª–∞—Ö –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ —É–¥–∞—Ä–µ–Ω–∏–µ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ <strong>–ê</strong>.</p>
                        
                        <div class="example">
                            <div class="example-title">‚úÖ –ü—Ä–∏–º–µ—Ä—ã:</div>
                            <div class="explanation-words">
                                <span class="explanation-word">–±—Ä–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–±—Ä–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–≤–∑—è–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–≤–∑—è–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–≤–ª–∏–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–≤–æ—Ä–≤–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–≤–æ—Å–ø—Ä–∏–Ω—è–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–≤–æ—Å—Å–æ–∑–¥–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–≥–Ω–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–≥–Ω–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–¥–æ–±—Ä–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–¥–æ–±—Ä–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–¥–æ–∂–¥–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–∂–¥–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–∑–∞–Ω—è–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–∑–∞–ø–µ—Ä–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–∑–∞–ø–µ—Ä–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–∑–≤–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ª–≥–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ª–∏–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ª–∏–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–Ω–∞–≤—Ä–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–Ω–∞–¥–æ—Ä–≤–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–Ω–∞–∑–≤–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–Ω–∞–ª–∏–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–Ω–∞—Ä–≤–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–Ω–∞—á–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–æ–±–ª–∏–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–æ–±–Ω—è–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–æ–±–æ–≥–Ω–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–æ–±–æ–¥—Ä–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–æ—Ç–±—ã–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–æ—Ç–¥–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–æ—Ç–æ–∑–≤–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–æ—Ç–æ–∑–≤–∞–ª<span class="accent">–ê</span>—Å—å</span>
                                <span class="explanation-word">–ø–µ—Ä–µ–ª–∏–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ø–æ–∑–≤–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ø–æ–ª–∏–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ø–æ–Ω—è–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">–ø—Ä–∏–±—ã–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">—Ä–≤–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">—Å–Ω—è–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">—Å–æ–∑–¥–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">—Å–æ—Ä–≤–∞–ª<span class="accent">–ê</span></span>
                                <span class="explanation-word">—É–±—Ä–∞–ª<span class="accent">–ê</span></span>
                            </div>
                        </div>

                        <div class="exception">
                            <div class="exception-title">‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ 1: –ü—Ä–∏—Å—Ç–∞–≤–∫–∞ –í–´-</div>
                            <p>–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –≥–ª–∞–≥–æ–ª—ã –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π <strong>–í–´-</strong>, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è:</p>
                            <div class="explanation-words">
                                <span class="explanation-word"><span class="accent">–≤</span>–´–ª–∏–ª–∞</span>
                                <span class="explanation-word"><span class="accent">–≤</span>–´–∑–≤–∞–ª–∞</span>
                            </div>
                        </div>

                        <div class="exception">
                            <div class="exception-title">‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ 2: –û—Å–æ–±—ã–µ –≥–ª–∞–≥–æ–ª—ã</div>
                            <p>–£ –≥–ª–∞–≥–æ–ª–æ–≤ <strong>–∫–ª–∞—Å—Ç—å, –∫—Ä–∞—Å—Ç—å—Å—è, —Å–ª–∞—Ç—å, –ø–æ—Å–ª–∞—Ç—å, –æ—Ç–æ—Å–ª–∞—Ç—å</strong> —É–¥–∞—Ä–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ <strong>–ù–ï</strong> –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê, –∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ:</p>
                            <div class="explanation-words">
                                <span class="explanation-word"><span class="accent">–∫–ª</span>–ê–ª–∞</span>
                                <span class="explanation-word"><span class="accent">–∫—Ä</span>–ê–ª–∞—Å—å</span>
                                <span class="explanation-word"><span class="accent">—Å–ª</span>–ê–ª–∞</span>
                                <span class="explanation-word">–ø–æ—Å<span class="accent">–ª</span>–ê–ª–∞</span>
                                <span class="explanation-word">–æ—Ç–æ—Å<span class="accent">–ª</span>–ê–ª–∞</span>
                            </div>
                        </div>
                    `
                },
                questions: [
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–±—Ä–ê–ª–∞", "–±—Ä–ê–ª–ê", "–±—Ä–∞–ª–ê", "–±—Ä–ê–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –±—Ä–∞–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–≤–∑–Ø–ª–∞", "–≤–∑–Ø–ª–ê", "–≤–∑—è–ª–ê", "–≤–∑–Ø–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–∑—è–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–ø–æ–Ω–Ø–ª–∞", "–ø–æ–Ω–Ø–ª–ê", "–ø–æ–Ω—è–ª–ê", "–ø–æ–Ω–Ø–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø–æ–Ω—è–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["—Å–æ–∑–¥–ê–ª–∞", "—Å–æ–∑–¥–ê–ª–ê", "—Å–æ–∑–¥–∞–ª–ê", "—Å–æ–∑–¥–ê–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Å–æ–∑–¥–∞–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–∑–≤–ê–ª–∞", "–∑–≤–ê–ª–ê", "–∑–≤–∞–ª–ê", "–∑–≤–ê–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∑–≤–∞–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π –í–´-)?",
                        answers: ["–≤–´–ª–∏–ª–∞", "–≤—ã–ª–ò–ª–∞", "–≤—ã–ª–∏–ª–ê", "–≤–´–ª–∏–ª–ê"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–´–ª–∏–ª–∞ - –ø—Ä–∏—Å—Ç–∞–≤–∫–∞ –í–´- –ø–µ—Ä–µ—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π –í–´-)?",
                        answers: ["–≤–´–∑–≤–∞–ª–∞", "–≤—ã–∑–≤–ê–ª–∞", "–≤—ã–∑–≤–∞–ª–ê", "–≤–´–∑–≤–∞–ª–ê"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–´–∑–≤–∞–ª–∞ - –ø—Ä–∏—Å—Ç–∞–≤–∫–∞ –í–´- –ø–µ—Ä–µ—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ —Å–µ–±—è"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–æ—Å–æ–±—ã–π –≥–ª–∞–≥–æ–ª)?",
                        answers: ["–∫–ª–ê–ª–∞", "–∫–ª–ê–ª–ê", "–∫–ª–∞–ª–ê", "–∫–ª–ê–ª–ê—Å—å"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∫–ª–ê–ª–∞ - —É –≥–ª–∞–≥–æ–ª–∞ '–∫–ª–∞—Å—Ç—å' —É–¥–∞—Ä–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê (–æ—Å–æ–±—ã–π –≥–ª–∞–≥–æ–ª)?",
                        answers: ["—Å–ª–ê–ª–∞", "—Å–ª–ê–ª–ê", "—Å–ª–∞–ª–ê", "—Å–ª–ê–ª–ê—Å—å"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Å–ª–ê–ª–∞ - —É –≥–ª–∞–≥–æ–ª–∞ '—Å–ª–∞—Ç—å' —É–¥–∞—Ä–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê?",
                        answers: ["–ø—Ä–∏–±–´–ª–∞", "–ø—Ä–∏–±–´–ª–ê", "–ø—Ä–∏–±—ã–ª–ê", "–ø—Ä–∏–±–´–ª–ê—Å—å"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø—Ä–∏–±—ã–ª–ê - —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –ê"
                    }
                ]
            },
            {
                id: 2,
                title: "–£—Ä–æ–≤–µ–Ω—å 2: –ü—É–Ω–∫—Ç—É–∞—Ü–∏—è",
                description: "–ó–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è",
                questions: [
                    {
                        question: "–£–∫–∞–∂–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –ø—É–Ω–∫—Ç—É–∞—Ü–∏–æ–Ω–Ω–æ–π –æ—à–∏–±–∫–æ–π:",
                        answers: [
                            "–°–æ–ª–Ω—Ü–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤–µ—Ç–∏–ª–æ —è—Ä–∫–æ, —Å–æ–≥—Ä–µ–≤–∞–ª–æ –∑–µ–º–ª—é.",
                            "–û–Ω –ø—Ä–∏—à–µ–ª, –Ω–æ –æ–Ω–∞ —É–∂–µ —É—à–ª–∞.",
                            "–í –ª–µ—Å—É, –≥–¥–µ –º—ã –≥—É–ª—è–ª–∏, –±—ã–ª–æ —Ç–∏—Ö–æ.",
                            "–Ø –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –¥–µ–ª–∞—Ç—å."
                        ],
                        correct: 0,
                        explanation: "–í –ø–µ—Ä–≤–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –∑–∞–ø—è—Ç–∞—è –ø–µ—Ä–µ–¥ '–∫–æ—Ç–æ—Ä–æ–µ' –Ω–µ –Ω—É–∂–Ω–∞"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∏—Ä–µ?",
                        answers: [
                            "–ú–æ—Å–∫–≤–∞ —Å—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏.",
                            "–ú–æ—Å–∫–≤–∞ —ç—Ç–æ —Å—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏.",
                            "–ú–æ—Å–∫–≤–∞ –±—ã–ª–∞ —Å—Ç–æ–ª–∏—Ü–µ–π –†–æ—Å—Å–∏–∏.",
                            "–ú–æ—Å–∫–≤–∞ —Å—Ç–∞–ª–∞ —Å—Ç–æ–ª–∏—Ü–µ–π –†–æ—Å—Å–∏–∏."
                        ],
                        correct: 0,
                        explanation: "–¢–∏—Ä–µ —Å—Ç–∞–≤–∏—Ç—Å—è –º–µ–∂–¥—É –ø–æ–¥–ª–µ–∂–∞—â–∏–º –∏ —Å–∫–∞–∑—É–µ–º—ã–º, –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–º–∏ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏"
                    },
                    {
                        question: "–ì–¥–µ –Ω—É–∂–Ω–∞ –∑–∞–ø—è—Ç–∞—è?",
                        answers: [
                            "–û–Ω –ø—Ä–∏—à–µ–ª(,) –Ω–æ –æ–Ω–∞ —É—à–ª–∞.",
                            "–û–Ω –ø—Ä–∏—à–µ–ª –Ω–æ(,) –æ–Ω–∞ —É—à–ª–∞.",
                            "–û–Ω –ø—Ä–∏—à–µ–ª –Ω–æ –æ–Ω–∞(,) —É—à–ª–∞.",
                            "–ó–∞–ø—è—Ç–∞—è –Ω–µ –Ω—É–∂–Ω–∞"
                        ],
                        correct: 0,
                        explanation: "–ó–∞–ø—è—Ç–∞—è —Å—Ç–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—é–∑–æ–º '–Ω–æ'"
                    }
                ]
            },
            {
                id: 3,
                title: "–£—Ä–æ–≤–µ–Ω—å 3: –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞",
                description: "–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å",
                questions: [
                    {
                        question: "–í –∫–∞–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –ù–ï —Å–æ —Å–ª–æ–≤–æ–º –ø–∏—à–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ?",
                        answers: [
                            "–≠—Ç–æ (–Ω–µ)–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å.",
                            "–û–Ω (–Ω–µ)–≤—ã—Å–æ–∫–∏–π, –∞ –Ω–∏–∑–∫–∏–π.",
                            "–ó–∞–¥–∞—á–∞ (–Ω–µ)—Ä–µ—à–µ–Ω–∞.",
                            "–û–Ω (–Ω–µ)–ø—Ä–∏—è—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫."
                        ],
                        correct: 1,
                        explanation: "–ù–ï –ø–∏—à–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —Å–æ—é–∑–æ–º '–∞'"
                    },
                    {
                        question: "–£–∫–∞–∂–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–æ–π:",
                        answers: [
                            "–û–Ω –ø—Ä–∏—à–µ–ª —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.",
                            "–ë–ª–∞–≥–æ–¥–∞—Ä—è –¥–æ–∂–¥—é, —É—Ä–æ–∂–∞–π –±—ã–ª —Ö–æ—Ä–æ—à–∏–º.",
                            "–ü–æ –ø—Ä–∏–µ–∑–¥—É –≤ –≥–æ—Ä–æ–¥, –æ–Ω —Å—Ä–∞–∑—É –ø–æ—à–µ–ª –≤ –º—É–∑–µ–π.",
                            "–í–æ–ø—Ä–µ–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º, –≤—Å–µ –ø—Ä–æ—à–ª–æ —Ö–æ—Ä–æ—à–æ."
                        ],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø–æ –ø—Ä–∏–µ–∑–¥–µ (–ø—Ä–µ–¥–ª–æ–≥ –ü–û —Ç—Ä–µ–±—É–µ—Ç –¥–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–¥–µ–∂–∞)"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ –ø–∏—à–µ—Ç—Å—è –¨?",
                        answers: ["–ø–ª–∞—â..", "–º—ã—à..", "–Ω–æ—á..", "–∫–ª—é—á.."],
                        correct: 1,
                        explanation: "–ú—è–≥–∫–∏–π –∑–Ω–∞–∫ –ø–∏—à–µ—Ç—Å—è –ø–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ 3-–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è"
                    }
                ]
            },
            {
                id: 4,
                title: "–£—Ä–æ–≤–µ–Ω—å 4: –£–¥–∞—Ä–µ–Ω–∏—è",
                description: "–û—Ä—Ñ–æ—ç–ø–∏—è",
                questions: [
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–ª–æ–≥?",
                        answers: ["–∑–≤–æ–Ω–ò—Ç", "–∫–≤–∞—Ä—Ç–ê–ª", "–¥–û–≥–æ–≤–æ—Ä", "—Å—Ä–µ–¥—Å—Ç–≤–ê"],
                        correct: 2,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –¥–û–≥–æ–≤–æ—Ä (—É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–ª–æ–≥)"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–≥?",
                        answers: ["–∑–≤–æ–Ω–ò—Ç", "–∫–≤–∞—Ä—Ç–ê–ª", "–¥–û–≥–æ–≤–æ—Ä", "—Å—Ä–µ–¥—Å—Ç–≤–ê"],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∑–≤–æ–Ω–ò—Ç (—É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–≥)"
                    },
                    {
                        question: "–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–æ–≥?",
                        answers: ["–∑–≤–æ–Ω–ò—Ç", "–∫–≤–∞—Ä—Ç–ê–ª", "–¥–û–≥–æ–≤–æ—Ä", "—Å—Ä–µ–¥—Å—Ç–≤–ê"],
                        correct: 1,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –∫–≤–∞—Ä—Ç–ê–ª (—É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–æ–≥)"
                    }
                ]
            },
            {
                id: 5,
                title: "–£—Ä–æ–≤–µ–Ω—å 5: –õ–µ–∫—Å–∏–∫–∞",
                description: "–°–ª–æ–≤–∞—Ä–Ω—ã–µ —Å–ª–æ–≤–∞",
                questions: [
                    {
                        question: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:",
                        answers: [
                            "–û–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ",
                            "–û–¥–µ—Ç—å—Å—è –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å—Å—è –ø–∞–ª—å—Ç–æ"
                        ],
                        correct: 1,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–∞–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ (–Ω–∞–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –Ω–∞ —Å–µ–±—è)"
                    },
                    {
                        question: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:",
                        answers: [
                            "–û–¥–µ—Ç—å —Ä–µ–±–µ–Ω–∫–∞",
                            "–ù–∞–¥–µ—Ç—å —Ä–µ–±–µ–Ω–∫–∞",
                            "–û–¥–µ—Ç—å—Å—è —Ä–µ–±–µ–Ω–∫–∞",
                            "–ù–∞–¥–µ—Ç—å—Å—è —Ä–µ–±–µ–Ω–∫–∞"
                        ],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –æ–¥–µ—Ç—å —Ä–µ–±–µ–Ω–∫–∞ (–æ–¥–µ—Ç—å –∫–æ–≥–æ-—Ç–æ)"
                    },
                    {
                        question: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:",
                        answers: [
                            "–û–¥–µ—Ç—å—Å—è –≤ –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å—Å—è –≤ –ø–∞–ª—å—Ç–æ",
                            "–û–¥–µ—Ç—å –≤ –ø–∞–ª—å—Ç–æ",
                            "–ù–∞–¥–µ—Ç—å –≤ –ø–∞–ª—å—Ç–æ"
                        ],
                        correct: 0,
                        explanation: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –æ–¥–µ—Ç—å—Å—è –≤ –ø–∞–ª—å—Ç–æ (–æ–¥–µ—Ç—å—Å—è –≤–æ —á—Ç–æ-—Ç–æ)"
                    }
                ]
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let currentLevel = null;
        let currentQuestion = 0;
        let score = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let gameStartTime = Date.now();
        let fallingWordsInterval = null;
        let questionTimeout = null;
        let consecutiveCorrect = 0;
        let completedLevels = JSON.parse(localStorage.getItem('completedLevels') || '{}');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ä–µ–∂–∏–º–∞ "9 –∑–∞–¥–∞–Ω–∏–µ"
        let task9Words = [];
        let task9AllWords = []; // –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
        let currentTask9Word = null;
        let task9CurrentIndex = 0;
        let task9Correct = 0;
        let task9Total = 0;

        // –ì–ª–∞—Å–Ω—ã–µ –±—É–∫–≤—ã
        const vowels = ['–∞', '–µ', '—ë', '–∏', '–æ', '—É', '—ã', '—ç', '—é', '—è'];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadTask9Words();
            loadProgressFromServer();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
        function loadProgressFromServer() {
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–µ—Å–ª–∏ –±–æ—Ç –ø–µ—Ä–µ–¥–∞–ª —á–µ—Ä–µ–∑ start_param)
            const urlParams = new URLSearchParams(window.location.search);
            const progressParam = urlParams.get('progress');
            if (progressParam) {
                try {
                    const serverProgress = JSON.parse(decodeURIComponent(progressParam));
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —Å–µ—Ä–≤–µ—Ä–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ)
                    Object.keys(serverProgress).forEach(levelId => {
                        const serverLevel = serverProgress[levelId];
                        const localLevel = completedLevels[levelId];
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–æ–ª—å—à–µ –∑–≤–µ–∑–¥)
                        if (!localLevel || serverLevel.stars > localLevel.stars) {
                            completedLevels[levelId] = serverLevel;
                        }
                    });
                    localStorage.setItem('completedLevels', JSON.stringify(completedLevels));
                    console.log('–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑ URL:', e);
                }
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
            if (tg && tg.sendData) {
                const syncRequest = {
                    action: 'sync_progress',
                    completedLevels: completedLevels
                };
                tg.sendData(JSON.stringify(syncRequest));
            }
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
        function syncProgressToServer() {
            if (tg && tg.sendData) {
                const syncData = {
                    action: 'save_progress',
                    completedLevels: completedLevels
                };
                tg.sendData(JSON.stringify(syncData));
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 9
        async function loadTask9Words() {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ JSON —Ñ–∞–π–ª–∞
                const response = await fetch('words_task9.json');
                if (response.ok) {
                    task9AllWords = await response.json();
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${task9AllWords.length} —Å–ª–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞`);
                } else {
                    // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    console.log('–§–∞–π–ª words_task9.json –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                    task9AllWords = getDefaultTask9Words();
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', error);
                task9AllWords = getDefaultTask9Words();
            }
        }

        // –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 9 (–µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω)
        function getDefaultTask9Words() {
            return [
                { word_with_gap: '–ø—Ä_–±—Ä–µ–∂–Ω—ã–π', correct_vowel: '–∏', full_word: '–ø—Ä–∏–±—Ä–µ–∂–Ω—ã–π', position: 2 },
                { word_with_gap: '–ø—Ä_–æ–¥–æ–ª–µ—Ç—å', correct_vowel: '–µ', full_word: '–ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å', position: 2 },
                { word_with_gap: '–ø—Ä_–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å', correct_vowel: '–µ', full_word: '–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å', position: 2 },
                { word_with_gap: '–ø—Ä_—Å–ª–µ–¥–æ–≤–∞—Ç—å', correct_vowel: '–µ', full_word: '–ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å', position: 2 },
                { word_with_gap: '–ø—Ä_–±—ã–≤–∞—Ç—å', correct_vowel: '–µ', full_word: '–ø—Ä–µ–±—ã–≤–∞—Ç—å', position: 2 },
                { word_with_gap: '–ø—Ä_–¥–∞—Ç—å', correct_vowel: '–µ', full_word: '–ø—Ä–µ–¥–∞—Ç—å', position: 2 },
                { word_with_gap: '–ø—Ä_–±—Ä–µ–∂–Ω—ã–π', correct_vowel: '–∏', full_word: '–ø—Ä–∏–±—Ä–µ–∂–Ω—ã–π', position: 2 },
                { word_with_gap: '–ø—Ä_–±–ª–∏–∑–∏—Ç—å—Å—è', correct_vowel: '–∏', full_word: '–ø—Ä–∏–±–ª–∏–∑–∏—Ç—å—Å—è', position: 2 },
                { word_with_gap: '–ø—Ä_–ª–µ—á—å', correct_vowel: '–∏', full_word: '–ø—Ä–∏–ª–µ—á—å', position: 2 },
                { word_with_gap: '–ø—Ä_–±—ã—Ç—å', correct_vowel: '–∏', full_word: '–ø—Ä–∏–±—ã—Ç—å', position: 2 }
            ];
        }

        // –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
        function selectMode(mode) {
            document.getElementById('modeSelectScreen').classList.remove('active');
            
            if (mode === 'arcade') {
                document.getElementById('levelSelectScreen').classList.add('active');
                renderLevelSelect();
            } else if (mode === 'task9') {
                document.getElementById('task9Screen').classList.add('active');
                startTask9();
            }
        }


        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç–∫—Ä–∞–Ω–∞ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π
        function renderLevelSelect() {
            const levelsList = document.getElementById('levelsList');
            const pathContainer = document.querySelector('.path-container');
            levelsList.innerHTML = '';

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–∞–º–Ω–∏ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            const oldStones = pathContainer.querySelectorAll('.path-stone');
            oldStones.forEach(stone => stone.remove());
            const oldPlayer = pathContainer.querySelector('.player-character');
            if (oldPlayer) oldPlayer.remove();

            // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            let lastCompletedLevel = 0;
            for (let i = 0; i < levels.length; i++) {
                if (completedLevels[levels[i].id]) {
                    lastCompletedLevel = i;
                }
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É—Ä–æ–≤–Ω–∏ –≤ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (column-reverse –ø–æ–∫–∞–∂–µ—Ç –∏—Ö —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
            levels.forEach((level, index) => {
                const isCompleted = completedLevels[level.id];
                // –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–µ–Ω, –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–æ–π–¥–µ–Ω
                const prevLevel = index > 0 ? levels[index - 1] : null;
                const isAvailable = index === 0 || (prevLevel && completedLevels[prevLevel.id]);

                const levelItem = document.createElement('div');
                levelItem.className = 'level-item';
                levelItem.dataset.levelIndex = index;

                const levelNode = document.createElement('div');
                levelNode.className = 'level-node';
                
                if (isCompleted) {
                    levelNode.classList.add('completed');
                    levelNode.textContent = '‚≠ê';
                } else if (isAvailable) {
                    levelNode.classList.add('available');
                    levelNode.textContent = level.id;
                    levelNode.onclick = () => startLevel(level);
                } else {
                    levelNode.classList.add('locked');
                    levelNode.textContent = 'üîí';
                }

                const levelInfo = document.createElement('div');
                levelInfo.className = 'level-info';
                levelInfo.innerHTML = `
                    <h3>${level.title}</h3>
                    <p>${level.description}</p>
                    ${isCompleted ? `<div class="level-stars">‚≠ê ${completedLevels[level.id].stars || 0}/3</div>` : ''}
                `;

                levelItem.appendChild(levelNode);
                levelItem.appendChild(levelInfo);
                levelsList.appendChild(levelItem);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–º–Ω–∏ –Ω–∞ —Ç—Ä–æ–ø–∏–Ω–∫—É –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏
            const levelItems = levelsList.querySelectorAll('.level-item');
            levelItems.forEach((item, index) => {
                if (index < levelItems.length - 1) {
                    // –î–æ–±–∞–≤–ª—è–µ–º 2-3 –∫–∞–º–Ω—è –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏
                    const stonesCount = 2 + Math.floor(Math.random() * 2);
                    for (let i = 0; i < stonesCount; i++) {
                        const stone = document.createElement('div');
                        stone.className = 'path-stone';
                        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∫–∞–º–Ω–∏ –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –∏ —Å–ª–µ–¥—É—é—â–∏–º —É—Ä–æ–≤–Ω–µ–º
                        const randomOffset = (Math.random() - 0.5) * 15;
                        stone.style.left = `calc(50% + ${randomOffset}px)`;
                        stone.style.top = `${30 + i * 15}px`;
                        pathContainer.appendChild(stone);
                    }

                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—É—é —Ç—Ä–∞–≤—É –ø–æ –±–æ–∫–∞–º
                    if (Math.random() > 0.5) {
                        const grassLeft = document.createElement('div');
                        grassLeft.className = 'path-decoration grass-left';
                        grassLeft.textContent = 'üåø';
                        grassLeft.style.top = `${20 + Math.random() * 20}px`;
                        pathContainer.appendChild(grassLeft);

                        const grassRight = document.createElement('div');
                        grassRight.className = 'path-decoration grass-right';
                        grassRight.textContent = 'üåø';
                        grassRight.style.top = `${20 + Math.random() * 20}px`;
                        pathContainer.appendChild(grassRight);
                    }
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ —Ç—Ä–æ–ø–∏–Ω–∫—É
            const playerChar = document.createElement('div');
            playerChar.className = 'player-character';
            playerChar.textContent = 'ü¶â';
            playerChar.title = '–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å';
            pathContainer.appendChild(playerChar);

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
            setTimeout(() => {
                positionPlayerOnPath(lastCompletedLevel);
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
                const levelSelectScreen = document.getElementById('levelSelectScreen');
                if (lastCompletedLevel >= 0 && lastCompletedLevel < levelItems.length) {
                    // –£—á–∏—Ç—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const visualIndex = levelItems.length - 1 - lastCompletedLevel;
                    const targetLevel = levelItems[visualIndex];
                    if (targetLevel) {
                        // –ñ–¥–µ–º, –ø–æ–∫–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è
                        requestAnimationFrame(() => {
                            const targetPosition = targetLevel.offsetTop - levelSelectScreen.clientHeight / 2 + targetLevel.offsetHeight / 2;
                            levelSelectScreen.scrollTo({
                                top: Math.max(0, targetPosition),
                                behavior: 'smooth'
                            });
                        });
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                    setTimeout(() => {
                        levelSelectScreen.scrollTop = levelSelectScreen.scrollHeight;
                    }, 50);
                }
            }, 150);
        }

        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ —Ç—Ä–æ–ø–∏–Ω–∫–µ
        function positionPlayerOnPath(levelIndex) {
            const playerChar = document.querySelector('.player-character');
            const levelsList = document.getElementById('levelsList');
            const levelItems = levelsList.querySelectorAll('.level-item');
            
            if (!playerChar || levelItems.length === 0) return;

            // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π, —Å—Ç–∞–≤–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤–Ω–∏–∑—É (–Ω–∞—á–∞–ª–æ —Ç—Ä–æ–ø–∏–Ω–∫–∏)
            if (levelIndex < 0) {
                playerChar.style.top = 'auto';
                playerChar.style.bottom = '20px';
                playerChar.style.animation = 'float 3s ease-in-out infinite';
                playerChar.classList.remove('walking');
                return;
            }

            // –£—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ —É—Ä–æ–≤–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (column-reverse)
            // –ü–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –≤ –º–∞—Å—Å–∏–≤–µ - —ç—Ç–æ –ø–µ—Ä–≤—ã–π –≤–∏–∑—É–∞–ª—å–Ω–æ (–≤–Ω–∏–∑—É)
            const visualIndex = levelItems.length - 1 - levelIndex;
            const targetLevel = levelItems[visualIndex];
            
            if (!targetLevel) {
                playerChar.style.top = 'auto';
                playerChar.style.bottom = '20px';
                playerChar.style.animation = 'float 3s ease-in-out infinite';
                playerChar.classList.remove('walking');
                return;
            }

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º offsetTop –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ levelsList
            const levelsListRect = levelsList.getBoundingClientRect();
            const levelRect = targetLevel.getBoundingClientRect();
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ü–µ–Ω—Ç—Ä–∞ —É—Ä–æ–≤–Ω—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ levelsList
            const levelCenter = levelRect.top - levelsListRect.top + levelRect.height / 2;
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ü–µ–Ω—Ç—Ä–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø –æ—Ç –≤–µ—Ä—Ö–∞ levelsList
            const pathContainer = document.querySelector('.path-container');
            const pathContainerPadding = 40; // padding-top path-container
            const topPosition = pathContainerPadding + levelCenter;
            
            playerChar.style.top = `${topPosition}px`;
            playerChar.style.bottom = 'auto';
            playerChar.style.animation = 'walk 0.6s ease-in-out infinite';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Ö–æ–¥—å–±—ã
            playerChar.classList.add('walking');
        }

        // –ó–∞–ø—É—Å–∫ —É—Ä–æ–≤–Ω—è
        function startLevel(level) {
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            correctAnswers = 0;
            totalQuestions = 0;
            consecutiveCorrect = 0;
            gameStartTime = Date.now();

            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ —Å–Ω–∞—á–∞–ª–∞
            if (level.explanation) {
                showExplanation(level);
            } else {
                // –ï—Å–ª–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –Ω–µ—Ç, —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–∞–∫—Ç–∏–∫—É
                startPractice();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        function showExplanation(level) {
            document.getElementById('levelSelectScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('explanationScreen').classList.add('active');

            const explanationContent = document.getElementById('explanationContent');
            explanationContent.innerHTML = `
                <h2>${level.explanation.title}</h2>
                ${level.explanation.content}
                <button class="start-practice-btn" onclick="startPractice()">
                    üéØ –ù–∞—á–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É
                </button>
            `;
        }

        // –ù–∞—á–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É (–ø–æ—Å–ª–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è)
        function startPractice() {
            document.getElementById('explanationScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('levelTitle').textContent = currentLevel.title;
            document.getElementById('levelComplete').classList.remove('show');
            document.getElementById('questionContainer').classList.remove('hidden');

            updateStats();
            showQuestion();
            startFallingWords();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        function showQuestion() {
            if (!currentLevel || currentQuestion >= currentLevel.questions.length) {
                completeLevel();
                return;
            }

            const q = currentLevel.questions[currentQuestion];
            document.getElementById('questionText').textContent = q.question;
            
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';

            q.answers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => selectAnswer(index);
                answersDiv.appendChild(btn);
            });

            totalQuestions++;
            updateStats();

            if (questionTimeout) clearTimeout(questionTimeout);
            questionTimeout = setTimeout(() => {
                selectAnswer(-1);
            }, 30000);
        }

        // –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
        function selectAnswer(selectedIndex) {
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            const q = currentLevel.questions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === q.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && index !== q.correct) {
                    btn.classList.add('wrong');
                }
            });

            if (selectedIndex === q.correct) {
                correctAnswers++;
                consecutiveCorrect++;
                score += 10 + (consecutiveCorrect > 1 ? 5 : 0);
                createParticles();
            } else {
                consecutiveCorrect = 0;
                if (selectedIndex !== -1) {
                    score = Math.max(0, score - 5);
                }
            }

            updateStats();

            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 2000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('correct').textContent = correctAnswers;
            document.getElementById('questionNum').textContent = totalQuestions;
            
            if (currentLevel) {
                const progress = (totalQuestions / currentLevel.questions.length) * 100;
                document.getElementById('progress').style.width = progress + '%';
            }
        }

        // –ü–∞–¥–∞—é—â–∏–µ —Å–ª–æ–≤–∞
        function startFallingWords() {
            if (fallingWordsInterval) clearInterval(fallingWordsInterval);
            
            const words = ['–ï–ì–≠', '–†—É—Å—Å–∫–∏–π', '–Ø–∑—ã–∫', '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞', '–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è', '–ü—É–Ω–∫—Ç—É–∞—Ü–∏—è'];
            
            fallingWordsInterval = setInterval(() => {
                const word = words[Math.floor(Math.random() * words.length)];
                createFallingWord(word);
            }, 2000);
        }

        function createFallingWord(word) {
            const gameArea = document.getElementById('gameArea');
            const wordEl = document.createElement('div');
            wordEl.className = 'falling-word';
            wordEl.textContent = word;
            wordEl.style.left = Math.random() * (gameArea.offsetWidth - 100) + 'px';
            wordEl.style.animationDuration = (3 + Math.random() * 2) + 's';
            gameArea.appendChild(wordEl);

            setTimeout(() => {
                wordEl.remove();
            }, 5000);
        }

        function createParticles() {
            const gameArea = document.getElementById('gameArea');
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * gameArea.offsetWidth + 'px';
                particle.style.top = (gameArea.offsetHeight - 200) + 'px';
                particle.style.animationDelay = (Math.random() * 0.5) + 's';
                gameArea.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        function completeLevel() {
            if (fallingWordsInterval) {
                clearInterval(fallingWordsInterval);
                fallingWordsInterval = null;
            }
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            document.getElementById('questionContainer').classList.add('hidden');
            
            const timeSpent = Math.floor((Date.now() - gameStartTime) / 1000);
            const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥ (1-3)
            let stars = 1;
            if (accuracy >= 100) stars = 3;
            else if (accuracy >= 70) stars = 2;

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const wasCompleted = completedLevels[currentLevel.id];
            if (!wasCompleted || completedLevels[currentLevel.id].stars < stars) {
                completedLevels[currentLevel.id] = {
                    stars: stars,
                    score: score,
                    accuracy: accuracy
                };
                localStorage.setItem('completedLevels', JSON.stringify(completedLevels));
            }

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalCorrect').textContent = correctAnswers;
            document.getElementById('finalTotal').textContent = totalQuestions;
            document.getElementById('finalAccuracy').textContent = accuracy;
            document.getElementById('finalStars').textContent = stars;

            document.getElementById('levelComplete').classList.add('show');

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –±–æ—Ç–∞
            if (tg && tg.sendData) {
                const result = {
                    level: currentLevel.id,
                    score: score,
                    correct: correctAnswers,
                    total: totalQuestions,
                    timeSpent: timeSpent,
                    accuracy: accuracy,
                    stars: stars,
                    completedLevels: completedLevels  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                };
                tg.sendData(JSON.stringify(result));
            }
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —Å–µ—Ä–≤–µ—Ä–æ–º
            syncProgressToServer();
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É —É—Ä–æ–≤–Ω–µ–π
        function backToLevelSelect() {
            if (fallingWordsInterval) {
                clearInterval(fallingWordsInterval);
                fallingWordsInterval = null;
            }
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            document.getElementById('explanationScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('levelSelectScreen').classList.add('active');
            renderLevelSelect();
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É —Ä–µ–∂–∏–º–∞
        function backToModeSelect() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
            if (fallingWordsInterval) {
                clearInterval(fallingWordsInterval);
                fallingWordsInterval = null;
            }
            if (questionTimeout) {
                clearTimeout(questionTimeout);
                questionTimeout = null;
            }

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.getElementById('levelSelectScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('task9Screen').classList.remove('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
            document.getElementById('modeSelectScreen').classList.add('active');
        }

        // –ü–æ–≤—Ç–æ—Ä —É—Ä–æ–≤–Ω—è
        function restartLevel() {
            if (currentLevel) {
                startLevel(currentLevel);
            }
        }

        // ========== –†–ï–ñ–ò–ú "9 –ó–ê–î–ê–ù–ò–ï" ==========

        // –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞–Ω–∏—è 9
        function startTask9() {
            if (task9AllWords.length === 0) {
                alert('–°–ª–æ–≤–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª words_task9.json');
                return;
            }

            // –í—ã–±–∏—Ä–∞–µ–º 10 —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤ –∏–∑ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
            const allWords = [...task9AllWords];
            const shuffled = allWords.sort(() => Math.random() - 0.5);
            task9Words = shuffled.slice(0, 10); // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
            
            task9CurrentIndex = 0;
            task9Correct = 0;
            task9Total = 0;

            document.getElementById('task9Complete').classList.remove('show');
            document.getElementById('task9QuestionContainer').style.display = 'block';
            document.getElementById('fullWordReveal').style.display = 'none';

            updateTask9Stats();
            showTask9Word();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–æ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º
        function showTask9Word() {
            if (task9CurrentIndex >= task9Words.length) {
                completeTask9();
                return;
            }

            currentTask9Word = task9Words[task9CurrentIndex];
            task9Total++;

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ª–æ–≤–æ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º
            const wordDisplay = document.getElementById('wordDisplay');
            const wordWithGap = currentTask9Word.word_with_gap;
            const gapPos = wordWithGap.indexOf('_');
            
            let displayHTML = '';
            for (let i = 0; i < wordWithGap.length; i++) {
                if (wordWithGap[i] === '_') {
                    displayHTML += '<span class="gap">_</span>';
                } else {
                    displayHTML += wordWithGap[i];
                }
            }
            wordDisplay.innerHTML = displayHTML;

            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–ª–æ–≤–æ
            document.getElementById('fullWordReveal').style.display = 'none';

            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å –≥–ª–∞—Å–Ω—ã–º–∏
            const vowelButtons = document.getElementById('vowelButtons');
            vowelButtons.innerHTML = '';

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≥–ª–∞—Å–Ω—ã–µ –∏ –±–µ—Ä–µ–º 5 —Å–ª—É—á–∞–π–Ω—ã—Ö + –ø—Ä–∞–≤–∏–ª—å–Ω—É—é
            const shuffledVowels = [...vowels].sort(() => Math.random() - 0.5);
            const options = [currentTask9Word.correct_vowel];
            for (let v of shuffledVowels) {
                if (v !== currentTask9Word.correct_vowel && options.length < 5) {
                    options.push(v);
                }
            }
            options.sort(() => Math.random() - 0.5);

            options.forEach(vowel => {
                const btn = document.createElement('button');
                btn.className = 'vowel-btn';
                btn.textContent = vowel.toUpperCase();
                btn.onclick = () => selectVowel(vowel);
                vowelButtons.appendChild(btn);
            });

            updateTask9Stats();
        }

        // –í—ã–±–æ—Ä –≥–ª–∞—Å–Ω–æ–π
        function selectVowel(selectedVowel) {
            const buttons = document.querySelectorAll('.vowel-btn');
            buttons.forEach(btn => btn.disabled = true);

            const isCorrect = selectedVowel === currentTask9Word.correct_vowel;

            buttons.forEach(btn => {
                if (btn.textContent.toLowerCase() === currentTask9Word.correct_vowel) {
                    btn.classList.add('correct');
                } else if (btn.textContent.toLowerCase() === selectedVowel && !isCorrect) {
                    btn.classList.add('wrong');
                }
            });

            if (isCorrect) {
                task9Correct++;
                createParticles();
            }

            updateTask9Stats();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–ª–æ–≤–æ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                showFullWord();
            }, 1000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Å–ª–æ–≤–æ
        function showFullWord() {
            const fullWordReveal = document.getElementById('fullWordReveal');
            fullWordReveal.textContent = `‚úì ${currentTask9Word.full_word.toUpperCase()}`;
            fullWordReveal.style.display = 'block';

            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–æ–≤—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                task9CurrentIndex++;
                showTask9Word();
            }, 2000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–¥–∞–Ω–∏—è 9
        function updateTask9Stats() {
            document.getElementById('task9Correct').textContent = task9Correct;
            document.getElementById('task9Total').textContent = task9Total;
            const accuracy = task9Total > 0 ? Math.round((task9Correct / task9Total) * 100) : 0;
            document.getElementById('task9Accuracy').textContent = accuracy;
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è 9
        function completeTask9() {
            document.getElementById('task9QuestionContainer').style.display = 'none';

            const accuracy = task9Total > 0 ? Math.round((task9Correct / task9Total) * 100) : 0;

            document.getElementById('task9FinalCorrect').textContent = task9Correct;
            document.getElementById('task9FinalTotal').textContent = task9Total;
            document.getElementById('task9FinalAccuracy').textContent = accuracy;

            document.getElementById('task9Complete').classList.add('show');

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –±–æ—Ç–∞
            if (tg && tg.sendData) {
                const result = {
                    mode: 'task9',
                    correct: task9Correct,
                    total: task9Total,
                    accuracy: accuracy
                };
                tg.sendData(JSON.stringify(result));
            }
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–¥–∞–Ω–∏—è 9
        function restartTask9() {
            startTask9();
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        init();
    </script>
</body>
</html>




